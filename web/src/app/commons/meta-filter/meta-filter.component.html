<ng-template #dialog let-modal ngNativeValidate>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">{{mode === 0 ? 'Keresés' : 'Kiválasztás'}}</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form #searchForm="ngForm" id="dialog"(ngSubmit)="filter(searchForm, modal)" novalidate (change)="searchDataChanged($event)">
      <div class="form-group">
        <label for="search_metrics" class="mr-2">Mérőszám</label>
        <div #tree ngbDropdown class="d-inline-block">
          <button type="button" class="btn btn-outline-primary" id="search_metrics" ngbDropdownToggle [disabled]="disableMetricSelection">{{searchModel.metricName ? searchModel.metricName : 'Select metric...'}}</button>
          <div ngbDropdownMenu aria-labelledby="search_metrics" (click)="toggleMetricNode($event)">
            <ul>
              <ng-container
                *ngTemplateOutlet="metricListTmpl; context:{ list: metricTree }"
              ></ng-container>
            </ul>
            <ng-template #metricListTmpl let-list="list">
              <li *ngFor="let item of list" id="{{item.id}}" class="closed {{item.children.length === 0 ? 'leaf' : '' }}" data-type="{{item.type}}">
                <i class="bi bi-plus-square"></i>
                <i class="bi bi-dash-square"></i>
                <span class="pl-2 pr-2">{{ item.name }}</span>
                <button *ngIf="item.level === 'category' && item.name === 'CONDITION'" type="button" class="category btn btn-sm btn-outline-primary">kiválaszt</button>
                <ul *ngIf="item.children.length > 0">
                  <ng-container
                    *ngTemplateOutlet="metricListTmpl; context:{ list: item.children }"
                  ></ng-container>
                </ul>
              </li>
            </ng-template>
         </div>
        </div>
      </div>
      <div *ngIf="!onlySelector" class="form-group">
        <label for="search_value" class="mr-2">Érrék</label>
        <div *ngIf="searchModel.metricType == 'SAMPLE'" class="row form-group pr-3 pl-3">
          <select name="search_rel" [(ngModel)]="searchModel.relation" class="form-control mr-2 col">
            <option value="=">=</option>
            <option value=">">></option>
            <option value="<"><</option>
            <option value=">="><</option>
            <option value="<="><</option>
            <option value="!=">!=</option>
          </select>
          <input type="number" name="search_value" [(ngModel)]="searchModel.value" class="form-control col-8"/>
        </div>
        <div *ngIf="searchModel.metricType == 'EVENT'" class="row form-group pr-3 pl-3">
          <select name="search_rel" [(ngModel)]="searchModel.relation" class="form-control mr-2 col" >
            <option *ngFor="let op of eventOps" value="{{op[0]}}">{{op[1]}}</option>
          </select>
          <input type="text" name="search_value" [(ngModel)]="searchModel.value" class="form-control col-8"
            [ngbTypeahead]="searchForEventValues"
            (focus)="focus$.next($any($event).target.value)"
            (click)="click$.next($any($event).target.value)"
            #eventValuesSelector="ngbTypeahead"
         />
        </div>
        <div *ngIf="searchModel.metricType == 'CONDITION'" class="form-group row">
          <div id="search_condition_types" class="btn-group btn-group-toggle mr-2 col" ngbRadioGroup name="search_value" [(ngModel)]="searchModel.value">
            <label ngbButtonLabel  class="condition btn-outline-primary mr-2 fault" title="fault">
              <input ngbButton type="radio" value="Fault"> &nbsp;
            </label>
            <label ngbButtonLabel class="condition btn-outline-primary mr-2 warning" title="warning" >
              <input ngbButton type="radio" value="Warning"> &nbsp;
            </label>
            <label ngbButtonLabel  class="condition btn-outline-primary mr-2 fault-warning" title="fault + warning">
              <input ngbButton type="radio" value="Fault|Warning"> &nbsp;
            </label>
            <label ngbButtonLabel  class="condition btn-outline-primary mr-2 normal" title="normal">
              <input ngbButton type="radio" value="Normal|Unavailable"> &nbsp;
            </label>
          </div>
          <div class="col-7">
            <input #search_cond_extra type="text" name="search_extra" [(ngModel)]="searchModel.extra" class="form-control" [disabled]="searchModel.value === 'Normal|Unavailable'" />
          </div>
        </div>
      </div>
      <div>
        <ngb-alert class="mt-3" *ngIf="searchError.show" [type]="'danger'" [dismissible]="false">{{searchError.message}}</ngb-alert>
      </div>
      <input type="submit" #submit />
    </form>
  </div>
  <div class="modal-footer">
    <button *ngIf="mode === 0" type="button" class="btn btn-outline-primary" (click)="searchModel.direction = '-1'; submit.click()">Visszafelé</button>
    <button *ngIf="mode === 0" type="button" class="btn btn-outline-primary" (click)="searchModel.direction = '1'; submit.click()">Előre</button>
    <button *ngIf="mode === 1" type="button" class="btn btn-outline-primary" (click)="submit.click()">Kiválaszt</button>
    <button type="button" class="btn btn-outline-primary" (click)="searchError.show = false; modal.dismiss()">Cancel</button>
  </div>
</ng-template>
