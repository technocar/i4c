<app-analysis-datetime-def #period [def]="def"></app-analysis-datetime-def>
<div id="analysing_data" class="row form-group m-0 mb-4 align-items-center">
  <label class="col">Elemezendő adat</label>
  <select class="col form-control" [ngModel]="def.obj.type" (change)="objectChanged(def.obj.type)">
    <option *ngFor="let obj of objects$ | async" [value]="obj.name">{{obj.displayname}}</option>
  </select>
</div>
<div class="row m-0">
  <fieldset class="filters col-12 p-4">
    <legend>szűrő</legend>
    <table class="table mr-0 mt-2 text-center">
      <tbody>
        <tr class="filter mr-0 mt-2" *ngFor="let filter of filters$ | async">
          <td>
            <select class="form-control" [(ngModel)]="filter.field" (change)="updateFilterField(filter)">
              <option *ngFor="let field of fields$ | async" [value]="field.name">{{field.displayname}}</option>
            </select>
          </td>
          <td>
            <select class="form-control mr-2" [(ngModel)]="filter.rel">
              <option *ngFor="let op of operators" value="{{op}}">{{op}}</option>
            </select>
          </td>
          <td>
            <input class="form-control mr-2" [(ngModel)]="filter.value" *ngIf="filter.values.length === 0" />
            <select class="form-control mr-2" [(ngModel)]="filter.value" *ngIf="filter.values.length > 0">
              <option *ngFor="let value of filter.values" [value]="value">{{value}}</option>
            </select>
          </td>
          <td>
            <button class="btn btn-outline-danger" title="törlés" (click)="deleteFilter(filter)">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <button class="btn btn-primary mt-4" (click)="newFilter()">
      <i class="bi bi-plus"></i>
      hozzadás...
    </button>
  </fieldset>
  <fieldset class="params col p-4 mt-4 mr-2">
    <legend>paraméterek</legend>
    <div class="row form-group">
      <label class="col-6">x</label>
      <select class="col form-control" [(ngModel)]="def.x">
        <option *ngFor="let field of fields$ | async" [value]="field.name">{{field.displayname}}</option>
      </select>
    </div>
    <div class="row form-group">
      <label class="col-6">y</label>
      <select class="col form-control" [(ngModel)]="def.y">
        <option *ngFor="let field of fields$ | async" [value]="field.name">{{field.displayname}}</option>
      </select>
    </div>
    <div class="row form-group">
      <label class="col-6">forma</label>
      <select class="col form-control" [(ngModel)]="def.shape">
        <option *ngFor="let field of fields$ | async" [value]="field.name">{{field.displayname}}</option>
      </select>
    </div>
    <div class="row form-group">
      <label class="col-6">szín</label>
      <select class="col form-control" [(ngModel)]="def.color">
        <option *ngFor="let field of fields$ | async" [value]="field.name">{{field.displayname}}</option>
      </select>
    </div>
    <fieldset class="row p-4">
      <legend>egyéb adatok</legend>
      <div class="col-12" *ngFor="let other of others$ | async">
        <div class="row mb-2">
          <select class="col form-control mr-2" [(ngModel)]="other.field_name">
            <option *ngFor="let field of fields$ | async" [value]="field.name">{{field.displayname}}</option>
          </select>
          <button class="btn btn-outline-danger" title="törlés" (click)="deleteOther(other.id)">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>
      <button class="btn btn-primary mt-2" (click)="newOther()">
        <i class="bi bi-plus"></i>
        hozzadás
      </button>
    </fieldset>
  </fieldset>
  <fieldset class="chart-settings col p-4 mt-4 ml-2">
    <legend>grafikon beállítás</legend>
    <div class="row form-group">
      <label class="col">megnevezés</label>
      <input class="col form-control" [(ngModel)]="def.visualsettings.title" />
    </div>
    <div class="row form-group">
      <label class="col">rövid magyarázat</label>
      <input class="col form-control" [(ngModel)]="def.visualsettings.subtitle" />
    </div>
    <fieldset class="row p-4 mt-4" *ngFor="let axis of ['x', 'y']">
      <legend>{{axis}} tengely</legend>
      <div class="col">
        <div class="row form-group">
          <label class="col">felirat</label>
          <input class="col form-control" [(ngModel)]="def.visualsettings[axis + 'axis'].caption" />
        </div>
      </div>
    </fieldset>
    <fieldset class="row p-4 mt-4">
      <legend>Jelmagyarázat</legend>
      <div class="col">
        <div class="row form-group">
          <label class="col">pozició</label>
          <select class="col form-control" [(ngModel)]="def.visualsettings.legend.position">
            <option *ngFor="let p of labels.legend.positions" [value]="p[0]">{{p[1]}}</option>
          </select>
        </div>
        <div class="row form-group">
          <label class="col">igazítás</label>
          <select class="col form-control" [(ngModel)]="def.visualsettings.legend.align">
            <option *ngFor="let a of labels.legend.aligns" [value]="a[0]">{{a[1]}}</option>
          </select>
        </div>
      </div>
    </fieldset>
  </fieldset>
</div>
